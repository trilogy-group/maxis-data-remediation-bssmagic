[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor

# ============================================
# TypeScript Dashboard (Next.js) - Port 3000
# ============================================
[program:ts-dashboard]
command=npm start
directory=/app/ts-dashboard
environment=NODE_ENV="production",PORT="3000"
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/ts-dashboard.err.log
stdout_logfile=/var/log/supervisor/ts-dashboard.out.log
priority=10

# ============================================
# 1147-Gateway (FastAPI) - Port 8081
# ============================================
[program:gateway-1147]
command=python -m uvicorn app.main:app --host 0.0.0.0 --port 8081
directory=/app/1147-gateway
environment=PYTHONUNBUFFERED="1",PYTHONPATH="/app/1147-gateway"
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/gateway-1147.err.log
stdout_logfile=/var/log/supervisor/gateway-1147.out.log
priority=20
startsecs=5
startretries=5

# ============================================
# CloudSense JS Gateway (FastAPI + Playwright) - Port 8080
# ============================================
[program:gateway-js]
command=python -m uvicorn main:app --host 0.0.0.0 --port 8080
directory=/app/cloudsense-js-gateway
environment=PYTHONUNBUFFERED="1",PYTHONPATH="/app/cloudsense-js-gateway"
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/gateway-js.err.log
stdout_logfile=/var/log/supervisor/gateway-js.out.log
priority=30
startsecs=10
startretries=5

# ============================================
# Batch Orchestrator (FastAPI) - Port 8082
# ============================================
[program:batch-orchestrator]
command=python -m uvicorn app.main:app --host 0.0.0.0 --port 8082
directory=/app/batch-orchestrator
environment=PYTHONUNBUFFERED="1",PYTHONPATH="/app/batch-orchestrator",TMF_BASE_URL="http://bssmagic-alb-526861445.ap-southeast-1.elb.amazonaws.com",TMF_API_KEY="bssmagic-d58d6761265b01accc13e8b21bae8282",SCHEDULER_ENABLED="true"
autostart=true
autorestart=true
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0
priority=25
startsecs=5
startretries=5
